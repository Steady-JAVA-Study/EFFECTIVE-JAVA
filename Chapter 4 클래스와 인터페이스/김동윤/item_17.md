# 변경 가능성 최소화해라
## what is 불변 클래스
> 클래스의 인스턴스 값을 수정할 수 없는 클래스 
(ex) String, Wrapper Class, BigInteger, BigDecimal

## immutable class 만드는 법

### 1. 객체의 상태를 변경하는 메서드를 제공 C
setter 뿐만 아니라 메서드 내부에서 객체의 상태를 변경하지 않아야 한다.
### 2. 클래스를 확장할 수 없도록 한다.
클래스를 final로 선언
생성자를 private으로 제한하고, 정적 팩터리 메서드를 통해 인스턴스 생성
### 3. 모든 필드를 final로 선언
### 4. 모든 필드를 private으로 선언
가변 객체를 참조하더라도 이를 외부에서 직접 접근하지 못함
### 5. 자신 외에는 내부의 가변 컴포넌트에 접근할 수 없도록 한다.
불변 클래스의 필드에서 가변 객체를 참조하는 경우 그 가변 객체의 참조를 얻을 수 없어야 함.
가변 객체의 참조를 반환해서도 안된다. -> 다른 곳에서 변경 되었을 수도 있기 때문이다.
다음과 같이 가변 객체 Address를 참조하는 Member클래스가 있다.

## immutable class 장점
### 1. 단순하다.

- 생성된 시점의 상태가 파괴될 때까지 간직

### 2. 불변 객체는 근본적으로 스레드 안전하여 따로 동기화 할 필요 없다.
- Thread-safe 한 클래스를 만드는 가장 쉬운 방법.
- 불변 클래스는 한번 만든 인스턴스를 최대한 활용(예. public static final 상)
- 따라서 불변 객체는 안심하고 공유
### 3. 불변 객체는 객체의 필드로 쓰면 좋다.

- 불변식을 보장할 수 있다.
- Map 의 키나 Set 의 요소로 불변객체를 사용하면 불변식을 지키기 쉽다.

### 4. 불변 객체는 실패 원자성을 제공한다.

실패 원자성 : 메서드 수행 중 예외가 발생해도 객체는 상태를 유지
## immutable class 단점
- 불변 객체의 단점은 결국 새로운 인스턴스 생성에 대한 문제
- 특히 인스턴스 생성의 비용이 큰 경우 problem
(ex 100만 비트 짜리 BigInteger, 생명 주기가 긴 객체 등)

## immutable class 단점 대책

### 1. 인스턴스 캐싱
인스턴스 캐싱을 통해 인스턴스를 새로 생성하지 않고 재사용하여 비용을 줄인다.
자바의 대부분의 기본값 wrapper클래스에서 사용되고 있는 방식이다. (Boolean, Integer, String...)
### 2. 다단계 연산을 예측하여 기본 기능으로 제공
인스턴스를 생성하는데 여러 단계를 거치는데, 이 단계들을 예측하여 기능으로 제공하는 것을 뜻한다.
예를 들어 불변 객체 String은 가변 동반 클래스인 StringBuilder를 제공한다.
StringBuilder에서는 String 인스턴스를 생성하는 여러 단계를 쪼개어 가변으로 객체를 생성할 수 있는 기능을 제공한다. (append메서드를 예로 들 수 있다.)